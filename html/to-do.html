<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyRoutine</title>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 0; background-color: #f5f5f5; }
        .header { background-color: #e83e8c; color: white; padding: 10px; text-align: center; }
        .date { text-align: center; padding: 10px; cursor: pointer; }
        .calendar { display: flex; justify-content: center; gap: 10px; }
        .day { background-color: #e0e0e0; border-radius: 50%; width: 40px; height: 40px; line-height: 20px; text-align: center; cursor: pointer; }
        .day.active { background-color: #e83e8c; color: white; }
        .pinned { padding: 10px; margin: 10px; display: block; }
        .pinned-item { background-color: #f7d9e8; padding: 10px; margin-bottom: 10px; border-radius: 8px; display: flex; align-items: center; gap: 10px; }
        .tabs { display: flex; justify-content: space-around; padding: 10px; }
        .tab { background-color: #e0e0e0; padding: 10px; border-radius: 8px; cursor: pointer; }
        .tab.active { background-color: #e83e8c; color: white; }
        .routines, .todos { margin: 10px; }
        .routines { max-height: 300px; overflow-y: auto; }
        .todos { max-height: 300px; overflow-y: auto; }
        .routine { padding: 10px; margin-bottom: 10px; border-radius: 8px; display: flex; align-items: center; gap: 10px; }
        .routine button { background: #e83e8c; color: white; border: none; padding: 5px; cursor: pointer; margin-left: 5px; }
        .routine button.delete { background: red; }
        .routine button:hover { opacity: 0.8; }
        #routinesSection .add-form { 
            padding: 10px; 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
            position: sticky; 
            bottom: 0; 
            background-color: #f5f5f5; 
            z-index: 1; 
        }
        .add-form input { padding: 10px; }
        .add-form button { background-color: #e83e8c; color: white; border: none; padding: 10px; cursor: pointer; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background-color: white; display: flex; justify-content: space-around; padding: 10px; border-top: 1px solid #e0e0e0; }
        /* Light rainbow colors for routines */
        .routine:nth-child(1) { background-color: #ffebee; } /* Light Red */
        .routine:nth-child(2) { background-color: #fff3e0; } /* Light Orange */
        .routine:nth-child(3) { background-color: #fffde7; } /* Light Yellow */
        .routine:nth-child(4) { background-color: #e8f5e9; } /* Light Green */
        .routine:nth-child(5) { background-color: #e3f2fd; } /* Light Blue */
        .routine:nth-child(6) { background-color: #ede7f6; } /* Light Indigo */
        .routine:nth-child(7) { background-color: #f3e5f5; } /* Light Violet */
        .routine:nth-child(8) { background-color: #ffebee; } /* Light Red */
        .routine:nth-child(9) { background-color: #fff3e0; } /* Light Orange */
        .routine:nth-child(10) { background-color: #fffde7; } /* Light Yellow */
        .routine:nth-child(11) { background-color: #e8f5e9; } /* Light Green */
        .routine:nth-child(12) { background-color: #e3f2fd; } /* Light Blue */
        .routine:nth-child(13) { background-color: #ede7f6; } /* Light Indigo */
        .routine:nth-child(14) { background-color: #f3e5f5; } /* Light Violet */
        .routine:nth-child(15) { background-color: #ffebee; } /* Light Red */
        /* To-dos table styles */
        table { width: 100%; border-collapse: collapse; }
        th, td { border-bottom: 1px solid #ddd; padding: 10px; text-align: left; }
        .completed { text-decoration: line-through; }
        button { padding: 8px 15px; background-color: #e83e8c; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background-color: #c2255c; }
        .edit-button { margin-right: 5px; }
        .delete-button { margin-right: 5px; }
        .up-button { margin-right: 5px; }
        .down-button { margin-right: 5px; }
        .todos-add-form { display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; }
        .todos-add-form input { flex: 1; min-width: 100px; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
        .hidden { display: none; }
        .pinned-item button { background: #e83e8c; color: white; border: none; padding: 5px; cursor: pointer; margin-left: 5px; }
        .pinned-item button.delete { background: red; }
        .pinned-item button:hover { opacity: 0.8; }
        .calendar-picker { position: absolute; top: 60px; left: 50%; transform: translateX(-50%); background: white; border: 1px solid #e0e0e0; padding: 10px; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .calendar-header button { background: none; border: none; cursor: pointer; font-size: 16px; color: #e83e8c; }
        .days-grid { display: grid; grid-template-columns: repeat(7, 30px); gap: 5px; justify-content: center; }
        .day-cell { text-align: center; padding: 5px; cursor: pointer; }
        .day-cell:hover { background: #f0f0f0; }
        .day-cell.current { background: #e83e8c; color: white; border-radius: 50%; }
        .weekday { text-align: center; font-weight: bold; }
        /* Reflection styles */
        #reflectionsSection {
            margin: 10px;
            max-height: 500px;
            overflow-y: auto;
        }
        .container {
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
        }
        .section {
            margin-bottom: 15px;
            text-align: left;
        }
        .section h3 {
            margin: 0 0 5px 0;
            font-size: 1.1em;
            color: #555;
        }
        .section textarea {
            width: 100%;
            height: 60px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            resize: vertical;
            font-size: 0.9em;
            color: #666;
            box-sizing: border-box;
        }
        .section textarea::placeholder {
            color: #999;
        }
    </style>
</head>
<body>
    <div class="header">MyRoutine</div>
    <div class="date" id="currentDate" onclick="toggleCalendarPicker()">Jul 2025 â–¼</div>
    <div id="calendarPicker" class="calendar-picker hidden"></div>
    <div class="calendar" id="calendar"></div>
    <div class="pinned">
        <div id="pinnedList"></div>
        <div class="add-form">
            <input id="newPinnedEmoji" placeholder="Emoji (e.g., ğŸ“)">
            <input id="newPinnedText" placeholder="Text">
            <button onclick="addPinned()">Add Pinned</button>
        </div>
    </div>
    <div class="tabs">
        <div class="tab active" onclick="switchTab('routines')">Routines</div>
        <div class="tab" onclick="switchTab('todos')">To-dos</div>
        <div class="tab" onclick="switchTab('reflections')">Reflections</div>
    </div>
    <div id="routinesSection">
        <div class="routines" id="routinesList"></div>
        <div class="add-form">
            <input id="newTime" placeholder="Time (e.g., 19ì‹œ)">
            <input id="newEmoji" placeholder="Emoji (e.g., â¤ï¸)">
            <input id="newText" placeholder="Text">
            <button onclick="addRoutine()">Add Routine</button>
        </div>
    </div>
    <div id="todosSection" class="hidden">
        <div class="todos">
            <table id="taskList">
                <thead>
                    <tr>
                        <th>ì¤‘ìš”ê¸´ê¸‰ - ìš°ì„ ìˆœìœ„ - í•´ì•¼í• ì¼ - ì˜ˆìƒì†Œìš”ì‹œê°„ - ì‹œì‘ì‹œê°„ - ë§ˆê°ê¸°í•œ</th>
                        <th>ìˆ˜ì •ã€€ã€€ì‚­ì œã€€ã€€ìœ„ã€€ã€€ì•„ë˜</th>
                    </tr>
                </thead>
                <tbody id="todosBody"></tbody>
            </table>
        </div>
        <div class="todos-add-form">
            <input id="newImportance" placeholder="ì¤‘ìš”ê¸´ê¸‰">
            <input id="newPriority" placeholder="ìš°ì„ ìˆœìœ„">
            <input id="newTask" placeholder="í•´ì•¼í• ì¼">
            <input id="newEstimatedTime" placeholder="ì˜ˆìƒì†Œìš”ì‹œê°„">
            <input id="newStartTime" placeholder="ì‹œì‘ì‹œê°„">
            <input id="newDeadline" placeholder="ë§ˆê°ê¸°í•œ">
            <button onclick="addTodo()">ë“±ë¡</button>
        </div>
    </div>
    <div id="reflectionsSection" class="hidden">
        <div class="container">
            <div class="section">
                <h3>Words to self ></h3>
                <textarea id="wordsToSelf" placeholder="Anything you want to tell yourself?"></textarea>
            </div>
            <div class="section">
                <h3>ì¼ì–´ë‚  ìˆ˜ ìˆëŠ” ìµœê³ ì˜ ì‹œë‚˜ë¦¬ì˜¤ ></h3>
                <textarea id="reflection" placeholder="No pressure. Start with one sentence."></textarea>
            </div>
            <div class="section">
                <h3>ì˜¤ëŠ˜ ë‹¬ì„±í•  ëª©í‘œ (ì¤‘ìš”í•œ,ê¸´ê¸‰í•œ) ></h3>
                <textarea id="gratitude" placeholder="No pressure. Start with one sentence."></textarea>
            </div>
            <div class="section">
                <h3>ê°œì„ í•  ì  ></h3>
                <textarea id="challenges" placeholder="No pressure. Start with one sentence."></textarea>
            </div>
            <div class="section">
                <h3>ì˜¤ëŠ˜ ë‹¬ì„±í•œ ëª©í‘œ (ì¤‘ìš”í•œ, ê¸´ê¸‰í•œ) ></h3>
                <textarea id="plans" placeholder="No pressure. Start with one sentence."></textarea>
            </div>
            <div class="section">
                <h3>ë‚˜ì—ê²Œ ì¹­ì°¬ ë° ê°ì‚¬ ></h3>
                <textarea id="motivation" placeholder="No pressure. Start with one sentence."></textarea>
            </div>
            <div class="section">
                <h3>ë¬¸ì œì , ì¥ì• ë¬¼, ì‹¤íŒ¨í•œì´ìœ , ë°˜ì„± ></h3>
                <textarea id="reflection2" placeholder="No pressure. Start with one sentence."></textarea>
            </div>
            <div class="section">
                <h3>ì–¸ì œê¹Œì§€, ì–´ë–»ê²Œ, í•´ê²°ë°©ë²•, êµí›ˆ ></h3>
                <textarea id="reflection3" placeholder="No pressure. Start with one sentence."></textarea>
            </div>
            <div class="section">
                <h3>ë‚´ì¼ ë‹¬ì„±í•  ëª©í‘œ(ì¤‘ìš”í•œ,ê¸´ê¸‰í•œ) ></h3>
                <textarea id="reflection4" placeholder="No pressure. Start with one sentence."></textarea>
            </div>
        </div>
    </div>
    <div class="bottom-nav">
        <button>Home</button>
        <button>Statistics</button>
        <button>Discover</button>
        <button>Social</button>
        <button>MY</button>
    </div>

    <script>
        let currentDate = new Date(2025, 6, 23); // July 23, 2025
        let pickerDate;
        const dateKey = () => currentDate.toISOString().split('T')[0];

        function updateDateDisplay() {
            const month = currentDate.toLocaleString('default', { month: 'short' });
            document.getElementById('currentDate').textContent = `${month} ${currentDate.getFullYear()} â–¼`;
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';
            const start = new Date(currentDate);
            start.setDate(start.getDate() - start.getDay());
            for (let i = 0; i < 7; i++) {
                const day = new Date(start);
                day.setDate(day.getDate() + i);
                const div = document.createElement('div');
                div.className = 'day' + (day.toDateString() === currentDate.toDateString() ? ' active' : '');
                const span = document.createElement('span');
                span.innerHTML = `${day.toLocaleString('default', { weekday: 'short' })}<br>${day.getDate()}`;
                span.style.display = 'block';
                span.style.height = '100%';
                span.style.lineHeight = '20px';
                span.onclick = () => {
                    currentDate = day;
                    updateDateDisplay();
                    renderCalendar();
                    loadItems();
                };
                div.appendChild(span);
                calendar.appendChild(div);
            }
        }

        function toggleCalendarPicker() {
            const picker = document.getElementById('calendarPicker');
            if (picker.classList.contains('hidden')) {
                pickerDate = new Date(currentDate);
                renderMonthCalendar();
                picker.classList.remove('hidden');
            } else {
                picker.classList.add('hidden');
            }
        }

        function renderMonthCalendar() {
            const picker = document.getElementById('calendarPicker');
            picker.innerHTML = '';

            // Header
            const header = document.createElement('div');
            header.className = 'calendar-header';
            const prevYear = document.createElement('button');
            prevYear.textContent = '<<';
            prevYear.onclick = () => changeYear(-1);
            const prevMonth = document.createElement('button');
            prevMonth.textContent = '<';
            prevMonth.onclick = () => changeMonth(-1);
            const monthTitle = document.createElement('span');
            monthTitle.textContent = pickerDate.toLocaleString('default', { month: 'long', year: 'numeric' });
            const nextMonth = document.createElement('button');
            nextMonth.textContent = '>';
            nextMonth.onclick = () => changeMonth(1);
            const nextYear = document.createElement('button');
            nextYear.textContent = '>>';
            nextYear.onclick = () => changeYear(1);
            header.appendChild(prevYear);
            header.appendChild(prevMonth);
            header.appendChild(monthTitle);
            header.appendChild(nextMonth);
            header.appendChild(nextYear);
            picker.appendChild(header);

            // Weekdays
            const weekdays = document.createElement('div');
            weekdays.className = 'days-grid';
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                const d = document.createElement('div');
                d.className = 'weekday';
                d.textContent = day;
                weekdays.appendChild(d);
            });
            picker.appendChild(weekdays);

            // Days
            const daysGrid = document.createElement('div');
            daysGrid.className = 'days-grid';
            const firstDay = new Date(pickerDate.getFullYear(), pickerDate.getMonth(), 1);
            const lastDay = new Date(pickerDate.getFullYear(), pickerDate.getMonth() + 1, 0);
            const startDay = firstDay.getDay();
            for (let i = 0; i < startDay; i++) {
                const empty = document.createElement('div');
                daysGrid.appendChild(empty);
            }
            for (let d = 1; d <= lastDay.getDate(); d++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'day-cell';
                dayCell.textContent = d;
                if (d === currentDate.getDate() && pickerDate.getMonth() === currentDate.getMonth() && pickerDate.getFullYear() === currentDate.getFullYear()) {
                    dayCell.classList.add('current');
                }
                dayCell.onclick = () => {
                    currentDate = new Date(pickerDate.getFullYear(), pickerDate.getMonth(), d);
                    updateDateDisplay();
                    renderCalendar();
                    loadItems();
                    toggleCalendarPicker();
                };
                daysGrid.appendChild(dayCell);
            }
            picker.appendChild(daysGrid);
        }

        function changeMonth(delta) {
            pickerDate.setMonth(pickerDate.getMonth() + delta);
            renderMonthCalendar();
        }

        function changeYear(delta) {
            pickerDate.setFullYear(pickerDate.getFullYear() + delta);
            renderMonthCalendar();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.tab[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById('routinesSection').classList.toggle('hidden', tab !== 'routines');
            document.getElementById('todosSection').classList.toggle('hidden', tab !== 'todos');
            document.getElementById('reflectionsSection').classList.toggle('hidden', tab !== 'reflections');
        }

        function loadItems() {
            loadPinned();
            loadRoutines();
            loadTodos();
            loadReflections();
        }

        function loadPinned() {
            const pinned = JSON.parse(localStorage.getItem('pinned') || '{}');
            const currentPinned = pinned[dateKey()] || [];
            const list = document.getElementById('pinnedList');
            list.innerHTML = '';
            currentPinned.forEach((pin, index) => {
                const div = document.createElement('div');
                div.className = 'pinned-item';
                div.innerHTML = `
                    <span class="pinned-emoji">${pin.emoji}</span> <span class="pinned-text">${pin.text}</span>
                    <button onclick="editPinned(${index})">Edit</button>
                    <button class="delete" onclick="deletePinned(${index})">Delete</button>
                    <button onclick="movePinned(${index}, 'up')">Up</button>
                    <button onclick="movePinned(${index}, 'down')">Down</button>
                `;
                list.appendChild(div);
            });
        }

        function addPinned() {
            const emoji = document.getElementById('newPinnedEmoji').value;
            const text = document.getElementById('newPinnedText').value;
            if (!text) return;
            const pinned = JSON.parse(localStorage.getItem('pinned') || '{}');
            const currentPinned = pinned[dateKey()] || [];
            currentPinned.push({ emoji, text });
            pinned[dateKey()] = currentPinned;
            localStorage.setItem('pinned', JSON.stringify(pinned));
            document.getElementById('newPinnedEmoji').value = '';
            document.getElementById('newPinnedText').value = '';
            loadPinned();
        }

        function editPinned(index) {
            const pinned = JSON.parse(localStorage.getItem('pinned') || '{}');
            const currentPinned = pinned[dateKey()] || [];
            const pin = currentPinned[index];
            const newEmoji = prompt("Emoji ìˆ˜ì •:", pin.emoji || '');
            if (newEmoji !== null) pin.emoji = newEmoji;
            const newText = prompt("Text ìˆ˜ì •:", pin.text || '');
            if (newText !== null) pin.text = newText;
            pinned[dateKey()] = currentPinned;
            localStorage.setItem('pinned', JSON.stringify(pinned));
            loadPinned();
        }

        function deletePinned(index) {
            const pinned = JSON.parse(localStorage.getItem('pinned') || '{}');
            const currentPinned = pinned[dateKey()] || [];
            currentPinned.splice(index, 1);
            pinned[dateKey()] = currentPinned;
            localStorage.setItem('pinned', JSON.stringify(pinned));
            loadPinned();
        }

        function movePinned(index, direction) {
            const pinned = JSON.parse(localStorage.getItem('pinned') || '{}');
            const currentPinned = pinned[dateKey()] || [];
            if (direction === 'up' && index > 0) {
                [currentPinned[index - 1], currentPinned[index]] = [currentPinned[index], currentPinned[index - 1]];
            } else if (direction === 'down' && index < currentPinned.length - 1) {
                [currentPinned[index], currentPinned[index + 1]] = [currentPinned[index + 1], currentPinned[index]];
            }
            pinned[dateKey()] = currentPinned;
            localStorage.setItem('pinned', JSON.stringify(pinned));
            loadPinned();
        }

        function loadRoutines() {
            const routines = JSON.parse(localStorage.getItem('routines') || '{}');
            const currentRoutines = routines[dateKey()] || [];
            const list = document.getElementById('routinesList');
            list.innerHTML = '';
            currentRoutines.forEach((routine, index) => {
                const div = document.createElement('div');
                div.className = 'routine';
                div.innerHTML = `
                    <input type="checkbox" ${routine.checked ? 'checked' : ''} onchange="toggleRoutineCheck(${index})">
                    <span class="routine-time">${routine.time}</span> <span class="routine-emoji">${routine.emoji}</span> <span class="routine-text">${routine.text}</span>
                    <button onclick="editRoutine(${index})">Edit</button>
                    <button class="delete" onclick="deleteRoutine(${index})">Delete</button>
                    <button onclick="moveRoutine(${index}, 'up')">Up</button>
                    <button onclick="moveRoutine(${index}, 'down')">Down</button>
                `;
                list.appendChild(div);
            });
        }

        function addRoutine() {
            const time = document.getElementById('newTime').value;
            const emoji = document.getElementById('newEmoji').value;
            const text = document.getElementById('newText').value;
            if (!time || !text) return;
            const routines = JSON.parse(localStorage.getItem('routines') || '{}');
            const currentRoutines = routines[dateKey()] || [];
            currentRoutines.push({ time, emoji, text, checked: false });
            routines[dateKey()] = currentRoutines;
            localStorage.setItem('routines', JSON.stringify(routines));
            document.getElementById('newTime').value = '';
            document.getElementById('newEmoji').value = '';
            document.getElementById('newText').value = '';
            const routinesList = document.getElementById('routinesList');
            const scrollPosition = routinesList.scrollTop;
            loadRoutines();
            routinesList.scrollTop = scrollPosition;
        }

        function toggleRoutineCheck(index) {
            const routines = JSON.parse(localStorage.getItem('routines') || '{}');
            const currentRoutines = routines[dateKey()] || [];
            currentRoutines[index].checked = !currentRoutines[index].checked;
            routines[dateKey()] = currentRoutines;
            localStorage.setItem('routines', JSON.stringify(routines));
            const routinesList = document.getElementById('routinesList');
            const scrollPosition = routinesList.scrollTop;
            loadRoutines();
            routinesList.scrollTop = scrollPosition;
        }

        function editRoutine(index) {
            const routines = JSON.parse(localStorage.getItem('routines') || '{}');
            const currentRoutines = routines[dateKey()] || [];
            const routine = currentRoutines[index];
            const newTime = prompt("Time ìˆ˜ì •:", routine.time || '');
            if (newTime !== null) routine.time = newTime;
            const newEmoji = prompt("Emoji ìˆ˜ì •:", routine.emoji || '');
            if (newEmoji !== null) routine.emoji = newEmoji;
            const newText = prompt("Text ìˆ˜ì •:", routine.text || '');
            if (newText !== null) routine.text = newText;
            routines[dateKey()] = currentRoutines;
            localStorage.setItem('routines', JSON.stringify(routines));
            const routinesList = document.getElementById('routinesList');
            const scrollPosition = routinesList.scrollTop;
            loadRoutines();
            routinesList.scrollTop = scrollPosition;
        }

        function deleteRoutine(index) {
            const routines = JSON.parse(localStorage.getItem('routines') || '{}');
            const currentRoutines = routines[dateKey()] || [];
            currentRoutines.splice(index, 1);
            routines[dateKey()] = currentRoutines;
            localStorage.setItem('routines', JSON.stringify(routines));
            const routinesList = document.getElementById('routinesList');
            const scrollPosition = routinesList.scrollTop;
            loadRoutines();
            routinesList.scrollTop = scrollPosition;
        }

        function moveRoutine(index, direction) {
            const routines = JSON.parse(localStorage.getItem('routines') || '{}');
            const currentRoutines = routines[dateKey()] || [];
            if (direction === 'up' && index > 0) {
                [currentRoutines[index - 1], currentRoutines[index]] = [currentRoutines[index], currentRoutines[index - 1]];
            } else if (direction === 'down' && index < currentRoutines.length - 1) {
                [currentRoutines[index], currentRoutines[index + 1]] = [currentRoutines[index + 1], currentRoutines[index]];
            }
            routines[dateKey()] = currentRoutines;
            localStorage.setItem('routines', JSON.stringify(routines));
            const routinesList = document.getElementById('routinesList');
            const scrollPosition = routinesList.scrollTop;
            loadRoutines();
            routinesList.scrollTop = scrollPosition;
        }

        function loadTodos() {
            const todos = JSON.parse(localStorage.getItem('todos') || '{}');
            const currentTodos = todos[dateKey()] || [];
            const tbody = document.getElementById('todosBody');
            tbody.innerHTML = '';
            currentTodos.forEach((todo, index) => {
                const tr = document.createElement('tr');
                const tdTask = document.createElement('td');
                const checkBox = document.createElement('input');
                checkBox.type = 'checkbox';
                checkBox.checked = todo.checked;
                checkBox.onchange = () => toggleTodoCheck(index);
                tdTask.appendChild(checkBox);
                const label = document.createElement('span');
                label.innerHTML = `<span class="todo-importance">${todo.importance || ''}</span> - <span class="todo-priority">${todo.priority || ''}</span> - <span class="todo-task">${todo.task || ''}</span> - <span class="todo-estimatedTime">${todo.estimatedTime || ''}</span> - <span class="todo-startTime">${todo.startTime || ''}</span> - <span class="todo-deadline">${todo.deadline || ''}</span>`;
                if (todo.checked) label.classList.add('completed');
                tdTask.appendChild(label);
                const tdAction = document.createElement('td');
                const editButton = document.createElement('button');
                editButton.textContent = 'ìˆ˜ì •';
                editButton.classList.add('edit-button');
                editButton.addEventListener('click', () => editTodo(index));
                tdAction.appendChild(editButton);
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'ì‚­ì œ';
                deleteButton.classList.add('delete-button');
                deleteButton.addEventListener('click', () => deleteTodo(index));
                tdAction.appendChild(deleteButton);
                const upButton = document.createElement('button');
                upButton.textContent = 'ìœ„';
                upButton.classList.add('up-button');
                upButton.addEventListener('click', () => moveTodo(index, 'up'));
                tdAction.appendChild(upButton);
                const downButton = document.createElement('button');
                downButton.textContent = 'ì•„ë˜';
                downButton.classList.add('down-button');
                downButton.addEventListener('click', () => moveTodo(index, 'down'));
                tdAction.appendChild(downButton);
                tr.appendChild(tdTask);
                tr.appendChild(tdAction);
                tbody.appendChild(tr);
            });
        }

        function addTodo() {
            const importance = document.getElementById('newImportance').value;
            const priority = document.getElementById('newPriority').value;
            const task = document.getElementById('newTask').value;
            const estimatedTime = document.getElementById('newEstimatedTime').value;
            const startTime = document.getElementById('newStartTime').value;
            const deadline = document.getElementById('newDeadline').value;
            if (!task) {
                alert("í•´ì•¼í• ì¼ì„ ì…ë ¥í•˜ì„¸ìš”!");
                return;
            }
            const todos = JSON.parse(localStorage.getItem('todos') || '{}');
            const currentTodos = todos[dateKey()] || [];
            currentTodos.push({ importance, priority, task, estimatedTime, startTime, deadline, checked: false });
            todos[dateKey()] = currentTodos;
            localStorage.setItem('todos', JSON.stringify(todos));
            document.getElementById('newImportance').value = '';
            document.getElementById('newPriority').value = '';
            document.getElementById('newTask').value = '';
            document.getElementById('newEstimatedTime').value = '';
            document.getElementById('newStartTime').value = '';
            document.getElementById('newDeadline').value = '';
            loadTodos();
        }

        function toggleTodoCheck(index) {
            const todos = JSON.parse(localStorage.getItem('todos') || '{}');
            const currentTodos = todos[dateKey()] || [];
            currentTodos[index].checked = !currentTodos[index].checked;
            todos[dateKey()] = currentTodos;
            localStorage.setItem('todos', JSON.stringify(todos));
            loadTodos();
        }

        function deleteTodo(index) {
            const todos = JSON.parse(localStorage.getItem('todos') || '{}');
            const currentTodos = todos[dateKey()] || [];
            currentTodos.splice(index, 1);
            todos[dateKey()] = currentTodos;
            localStorage.setItem('todos', JSON.stringify(todos));
            loadTodos();
        }

        function editTodo(index) {
            const todos = JSON.parse(localStorage.getItem('todos') || '{}');
            const currentTodos = todos[dateKey()] || [];
            const todo = currentTodos[index];
            const newImportance = prompt("ì¤‘ìš”ê¸´ê¸‰ ìˆ˜ì •:", todo.importance || '');
            if (newImportance !== null) todo.importance = newImportance;
            const newPriority = prompt("ìš°ì„ ìˆœìœ„ ìˆ˜ì •:", todo.priority || '');
            if (newPriority !== null) todo.priority = newPriority;
            const newTask = prompt("í•´ì•¼í• ì¼ ìˆ˜ì •:", todo.task || '');
            if (newTask !== null) todo.task = newTask;
            const newEstimatedTime = prompt("ì˜ˆìƒì†Œìš”ì‹œê°„ ìˆ˜ì •:", todo.estimatedTime || '');
            if (newEstimatedTime !== null) todo.estimatedTime = newEstimatedTime;
            const newStartTime = prompt("ì‹œì‘ì‹œê°„ ìˆ˜ì •:", todo.startTime || '');
            if (newStartTime !== null) todo.startTime = newStartTime;
            const newDeadline = prompt("ë§ˆê°ê¸°í•œ ìˆ˜ì •:", todo.deadline || '');
            if (newDeadline !== null) todo.deadline = newDeadline;
            todos[dateKey()] = currentTodos;
            localStorage.setItem('todos', JSON.stringify(todos));
            loadTodos();
        }

        function moveTodo(index, direction) {
            const todos = JSON.parse(localStorage.getItem('todos') || '{}');
            const currentTodos = todos[dateKey()] || [];
            if (direction === 'up' && index > 0) {
                [currentTodos[index - 1], currentTodos[index]] = [currentTodos[index], currentTodos[index - 1]];
            } else if (direction === 'down' && index < currentTodos.length - 1) {
                [currentTodos[index], currentTodos[index + 1]] = [currentTodos[index + 1], currentTodos[index]];
            }
            todos[dateKey()] = currentTodos;
            localStorage.setItem('todos', JSON.stringify(todos));
            loadTodos();
        }

        function saveReflections() {
            const data = {
                wordsToSelf: document.getElementById('wordsToSelf').value,
                reflection: document.getElementById('reflection').value,
                gratitude: document.getElementById('gratitude').value,
                challenges: document.getElementById('challenges').value,
                plans: document.getElementById('plans').value,
                motivation: document.getElementById('motivation').value,
                reflection2: document.getElementById('reflection2').value,
                reflection3: document.getElementById('reflection3').value,
                reflection4: document.getElementById('reflection4').value
            };
            const reflections = JSON.parse(localStorage.getItem('reflections') || '{}');
            reflections[dateKey()] = data;
            localStorage.setItem('reflections', JSON.stringify(reflections));
        }

        function loadReflections() {
            const reflections = JSON.parse(localStorage.getItem('reflections') || '{}');
            const data = reflections[dateKey()] || {};
            document.getElementById('wordsToSelf').value = data.wordsToSelf || '';
            document.getElementById('reflection').value = data.reflection || '';
            document.getElementById('gratitude').value = data.gratitude || '';
            document.getElementById('challenges').value = data.challenges || '';
            document.getElementById('plans').value = data.plans || '';
            document.getElementById('motivation').value = data.motivation || '';
            document.getElementById('reflection2').value = data.reflection2 || '';
            document.getElementById('reflection3').value = data.reflection3 || '';
            document.getElementById('reflection4').value = data.reflection4 || '';
        }

        // Initial setup
        updateDateDisplay();
        renderCalendar();
        loadItems();

        // Reflection input save
        document.querySelectorAll('#reflectionsSection textarea').forEach(textarea => {
            textarea.addEventListener('input', saveReflections);
        });

        // Initial pinned if empty
        const pinned = JSON.parse(localStorage.getItem('pinned') || '{}');
        if (!pinned[dateKey()]) {
            pinned[dateKey()] = [
                { emoji: 'ğŸ“', text: 'Xtal Founder/CEO/CTO' }
            ];
            localStorage.setItem('pinned', JSON.stringify(pinned));
            loadPinned();
        }

        // Initial routines if empty
        const routines = JSON.parse(localStorage.getItem('routines') || '{}');
        if (!routines[dateKey()]) {
            routines[dateKey()] = [
                { time: '01ì‹œ', emoji: 'â¤ï¸', text: 'test', checked: false },
                { time: '02ì‹œ', emoji: 'ğŸ§¡', text: 'test', checked: false },
                { time: '03ì‹œ', emoji: 'ğŸ’›', text: 'test', checked: false },
                { time: '04ì‹œ', emoji: 'ğŸ’š', text: 'test', checked: false },
                { time: '05ì‹œ', emoji: 'ğŸ’™', text: 'test', checked: false },
                { time: '06ì‹œ', emoji: 'ğŸ’œ', text: 'test', checked: false },
                { time: '07ì‹œ', emoji: 'â¤ï¸', text: 'test', checked: false },
                { time: '08ì‹œ', emoji: 'ğŸ§¡', text: 'test', checked: false },
                { time: '09ì‹œ', emoji: 'ğŸ’›', text: 'test', checked: false },
                { time: '10ì‹œ', emoji: 'ğŸ’š', text: 'test', checked: false },
                { time: '11ì‹œ', emoji: 'ğŸ’™', text: 'test', checked: false },
                { time: '12ì‹œ', emoji: 'ğŸ’œ', text: 'test', checked: false },
                { time: '13ì‹œ', emoji: 'â¤ï¸', text: 'test', checked: false },
                { time: '14ì‹œ', emoji: 'ğŸ§¡', text: 'test', checked: false },
                { time: '15ì‹œ', emoji: 'ğŸ’›', text: 'test', checked: false },
                { time: '16ì‹œ', emoji: 'ğŸ’š', text: 'test', checked: false },
                { time: '17ì‹œ', emoji: 'ğŸ’™', text: 'test', checked: false },
                { time: '18ì‹œ', emoji: 'ğŸ’œ', text: 'test', checked: false },
                { time: '19ì‹œ', emoji: 'â¤ï¸', text: 'test', checked: false },
                { time: '20ì‹œ', emoji: 'ğŸ§¡', text: 'test', checked: false },
                { time: '21ì‹œ', emoji: 'ğŸ’›', text: 'test', checked: false },
                { time: '22ì‹œ', emoji: 'ğŸ’š', text: 'test', checked: false },
                { time: '23ì‹œ', emoji: 'ğŸ’™', text: 'test', checked: false },
                { time: '24ì‹œ', emoji: 'ğŸ’œ', text: 'test', checked: false }
            ];
            localStorage.setItem('routines', JSON.stringify(routines));
            loadRoutines();
        }
    </script>
</body>
</html>
